(self["webpackJsonp_proactiveServiceSaas"]=self["webpackJsonp_proactiveServiceSaas"]||[]).push([[323],{90385:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=90385,e.exports=t},16817:function(e,t,r){var i={"./UserEditPage.vue":3583,"./user-components/product-role.vue":46248};function n(e){var t=a(e);return r(t)}function a(e){if(!r.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=a,e.exports=n,n.id=16817},52323:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return P}});var i={};r.r(i);var n=function(){var e=this,t=e._self._c;return t("el-main",[t("BaseList",{attrs:{"menu-id":e.menuId,"fetch-method":e.fetchService,"menu-detail-method":e.getMenusDetail,"handle-resource":e.handleResource,"page-config":e.pageConfig}})],1)},a=[],o=r(82257);const s=r(16817),c={};s.keys().forEach((e=>{c[e.replace(/(^\.\/|\.vue$)/g,"")]=s(e).default}));var u=c;const l=r(90385),d={};l.keys().forEach((e=>{d[e.replace(/(^\.\/|\.vue$)/g,"")]=l(e).default}));var p=d,f=r(99534),h={clearLoginError({row:e}){const t={userName:e.userName};(0,f.fI)(t).then((({data:r})=>{if(!r)return this.$message.info(`${e.userName} 累计登录失败次数已经为 ${r},不需要重置！`);this.$confirm(`${e.userName} 累计登录失败次数为${r}, 是否解锁（将该用户的登录失败次数重置为0）?`,"提示",{type:"warning"}).then((()=>{(0,f.XY)(t,"解锁成功").then((()=>{this.clearSelected()}))})).catch((()=>{}))}))}},m=r(56414),g=r(65461),y={props:["menuId"],data(){return{handleResource:{pages:u,dialogs:p,todo:h,renderMethods:i.renderMethods},fetchService:m.Z,getMenusDetail:g.rZ}}},v={props:["menuId"],mixins:[y],components:{BaseList:o.D7},data(){return{pageConfig:{disabledSetHeight:!0}}}},b=v,w=r(1001),_=(0,w.Z)(b,n,a,!1,null,null,null),P=_.exports},3583:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"userForm",attrs:{"label-width":"150px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:"用户类型"}},[t("el-select",{attrs:{disabled:e.isEdit},model:{value:e.formData.pin,callback:function(t){e.$set(e.formData,"pin",t)},expression:"formData.pin"}},e._l(e.userEditList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:1===e.formData.pin?"用户账户":"域账号",prop:"userName",rules:1===e.formData.pin?e.userName:e.mainUserName}},[t("el-input",{attrs:{disabled:e.isEdit,placeholder:"请输入用户账户",autocomplete:"off"},model:{value:e.formData.userName,callback:function(t){e.$set(e.formData,"userName",t)},expression:"formData.userName"}})],1),t("el-form-item",{attrs:{label:"用户名称",prop:"userNickname"}},[t("el-input",{attrs:{placeholder:"请输入用户名称",autocomplete:"off"},model:{value:e.formData.userNickname,callback:function(t){e.$set(e.formData,"userNickname",t)},expression:"formData.userNickname"}})],1),t("el-form-item",{attrs:{label:"手机号",prop:"mobilePhone"}},[t("el-input",{attrs:{placeholder:"请输入手机号",maxlength:"11",autocomplete:"off"},model:{value:e.formData.mobilePhone,callback:function(t){e.$set(e.formData,"mobilePhone",t)},expression:"formData.mobilePhone"}})],1),t("el-form-item",{attrs:{label:"所属组织",prop:"depUniqueId"}},[t("el-cascader",{attrs:{options:e.depUniqueOptions,"show-all-levels":!1,props:{checkStrictly:!0,value:"uniqueId",label:"departmentName"}},model:{value:e.formData.depUniqueId,callback:function(t){e.$set(e.formData,"depUniqueId",t)},expression:"formData.depUniqueId"}})],1),1===e.formData.pin?[t("el-form-item",{attrs:{label:"邮箱",prop:"mailbox"}},[t("el-input",{attrs:{placeholder:"请输入邮箱",autocomplete:"off"},model:{value:e.formData.mailbox,callback:function(t){e.$set(e.formData,"mailbox",t)},expression:"formData.mailbox"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password",rules:e.passwordRules}},[t("input",{attrs:{type:"text",hidden:""}}),t("input",{attrs:{type:"password",hidden:"",autocomplete:"new-password"}}),t("el-input",{attrs:{placeholder:"请输入密码",autocomplete:"off",type:e.isShowPwd?"string":"password"},model:{value:e.formData.password,callback:function(t){e.$set(e.formData,"password",t)},expression:"formData.password"}},[t("el-button",{style:{fontSize:"14px",color:e.isShowPwd?"#409EFF":"#ccc"},attrs:{slot:"append",icon:"el-icon-view"},on:{click:function(t){e.isShowPwd=!e.isShowPwd}},slot:"append"})],1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-switch",{attrs:{"active-value":1,"inactive-value":2},model:{value:e.formData.state,callback:function(t){e.$set(e.formData,"state",t)},expression:"formData.state"}})],1)]:e._e(),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容"},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1),t("el-form-item",{attrs:{label:"产品角色"}},[t("product-role",{ref:"role",attrs:{product:e.productList,camPolicy:e.productObj,menu:e.menu}})],1),t("el-form-item",[t("el-button",{on:{click:function(t){return e.$emit("go-back")}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存并返回")])],1)],2)],1)},n=[],a=r(98269),o=r.n(a),s=r(55743),c=r.n(s),u=r(46248),l=r(65461),d=r(33621),p={components:{productRole:u["default"]},inject:["baseIndex"],props:["mode","id","menuId","menu"],data(){return{password1:"",isShowPwd:!1,formData:{pin:1,state:1},userEditList:[{label:"普通用户",value:1},{label:"域账号用户",value:3}],passwordRules:[{required:"create"===this.mode,message:"请填写密码",trigger:["blur","change"]},{pattern:/^(?=.*[A-Za-z])(?=.*\d)(?=.*[`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]])[A-Za-z\d`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]]{8,}$/,message:"至少8位且必需要有数字+特殊字符+字母",trigger:["blur","change"]},{max:16,message:"密码最长16位",trigger:["blur","change"]}],mainUserName:[{required:!0,message:"请填写域账户",trigger:["blur","change"]},{max:100,message:"域账户最长100位",trigger:["blur","change"]},{type:"email",message:"请填写正确域账户",trigger:"blur"}],userName:[{required:!0,message:"请填写用户账户",trigger:["blur","change"]},{pattern:/^[a-zA-Z0-9]+$/,message:"仅支持26个英文字母和数字0~9；最多32字符",trigger:["blur","change"]},{max:32,message:"用户账户最长32位",trigger:["blur","change"]}],rules:{productUniqueId:[{required:!0,message:"请选择产品",trigger:"change"}],userNickname:[{required:!0,message:"请填写用户名",trigger:["blur","change"]},{max:32,message:"用户名最长32位",trigger:["blur","change"]}],mobilePhone:[{required:!0,message:"请填写手机号码",trigger:"blur"},{trigger:"blur",validator:(e,t,r)=>{this.$cUtils.validate.isMobile(t)?r():r(new Error("请输入正确的手机号码"))}}],depUniqueId:[{trigger:"change",validator:(e,t,r)=>{t?r():r(new Error("请选择所属组织！"))}}],mailbox:[{type:"email",message:this.$t("message.emailIncorrect"),trigger:"blur"}]},apiServer:void 0,productList:[],productObj:{},depUniqueOptions:[]}},computed:{isEdit(){return"edit"===this.mode}},methods:{depTreeList(){this.apiServer("depTreeList")().then((e=>{this.depUniqueOptions=e}))},save(){this.$refs.userForm.validate((e=>{if(e){const e=JSON.parse(JSON.stringify(this.formData));let t;this.formData.password&&(t=o().stringify(c().parse(this.formData.password)));const r=Array.isArray(e.depUniqueId)?e.depUniqueId?.pop()||"0":e.depUniqueId;this.formData.mobilePhone&&"edit"===this.mode&&(this.formData.mobilePhone=void 0),this.apiServer("edit"===this.mode?"update":3===this.formData.pin?"addaAreaUser":"add")({data:{...e,password:t,depUniqueId:r,productCamPolicyDtoList:this.$refs.role.getData()}}).then((()=>{this.$emit("upsert-end")}))}}))},async listByProdUniqueld(e){let t=await this.apiServer("listByProdUniqueld")({params:{productUniqueId:e}});return t}},mounted(){},created(){const{api:e}=(0,d.mk)(this);this.apiServer=(0,l.$P)(e),this.apiServer("getProduct")({params:{page:1,pageSize:9999}}).then((({list:e})=>{this.productList=e;const t={};e.forEach((e=>{this.$set(t,e.uniqueId,e)})),"edit"===this.mode&&this.apiServer("detail")({params:{id:this.id}}).then((e=>{const r=JSON.parse(JSON.stringify(e.productCamPolicyDtoList));this.$delete(e,"productCamPolicyDtoList"),this.$set(e,"pin",3!==e.pin?1:3),r.forEach((e=>{const r=e.camPolicyList.map((e=>e.id)),i=e.productUniqueId;t[i]&&(this.$set(this.productObj,i,{cname:t[i].cname,uniqueId:i}),this.listByProdUniqueld(i).then((({list:e})=>{const t=e.map((e=>({choice:r.includes(e.id),...e})));this.$set(this.productObj[i],"role",t)})))})),this.formData=e}))})),this.depTreeList()}},f=p,h=r(1001),m=(0,h.Z)(f,i,n,!1,null,"610c58a8",null),g=m.exports},46248:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var i=function(){var e=this,t=e._self._c;return t("div",[Object.values(e.choiceProduct).length?t("div",{staticClass:"choice-role"},[e._l(e.choiceProduct,(function(r,i){return[t("div",{key:i,staticClass:"choice-product",class:r.uniqueId===e.choiceUniqueId?"cur-product":"",on:{click:function(t){e.choiceUniqueId=r.uniqueId}}},[t("span",{staticClass:"product"},[e._v(e._s(r.cname))]),e._l(r.role,(function(r,n){return[r.choice?t("el-tag",{key:`${i}_${n}`,staticStyle:{"margin-right":"5px"},attrs:{closable:"",type:"success"},on:{close:function(e){e.stopPropagation(),r.choice=!1}}},[e._v(e._s(r.policyName))]):e._e()]})),t("span",{staticClass:"close el-icon-close",on:{click:function(t){return t.stopPropagation(),e.$delete(e.choiceProduct,i)}}})],2)]})),t("div",{staticClass:"clear"})],2):e._e(),t("div",{staticClass:"product-role"},[t("div",{staticClass:"item"},[t("div",{staticClass:"item-title"},[e._v("产品列表")]),t("el-scrollbar",{staticStyle:{height:"calc(100% - 60px)","margin-top":"10px"}},e._l(e.productList,(function(r,i){return t("div",{key:i,staticClass:"product-list",class:r.uniqueId===e.choiceUniqueId?"cur-product":"",on:{click:function(t){return e.updateProduct(r)}}},[e._v(e._s(r.cname))])})),0)],1),t("div",{staticClass:"item"},[t("div",{staticClass:"item-title"},[e._v("角色列表 "),(e.choiceProduct[e.choiceUniqueId]||{}).cname?t("span",[e._v("("+e._s((e.choiceProduct[e.choiceUniqueId]||{}).cname)+")")]):e._e()]),t("el-scrollbar",{staticStyle:{height:"calc(100% - 60px)","margin-top":"10px"}},[t("div",{staticStyle:{padding:"10px"}},[!e.getRole.length&&(e.choiceProduct[e.choiceUniqueId]||{}).cname?t("el-empty",{attrs:{description:"该产品无角色"}}):e._e(),e._l(e.getRole,(function(r,i){return t("el-button",{key:i,staticStyle:{"margin-bottom":"10px"},attrs:{plain:"",type:r.choice?"primary":"default"},on:{click:function(t){return e.clickRole(r)}}},[e._v(e._s(r.policyName))])}))],2)])],1)])])},n=[],a=(r(57658),r(56414)),o={components:{},props:{product:{type:Array,default:()=>[]},menu:{type:Object,default:()=>({})},camPolicy:{type:[Array,Object],default:()=>({})}},data(){return{api:{},choiceProduct:{},choiceRole:[],productList:[],choiceUniqueId:""}},computed:{getRole(){return(this.choiceProduct[this.choiceUniqueId]||{}).role||[]}},watch:{product:{handler(e){this.productList=JSON.parse(JSON.stringify(e))},deep:!0},camPolicy:{handler(e){this.choiceProduct=JSON.parse(JSON.stringify(e))},deep:!0}},methods:{roleChoiceLength(e){return(e.role||[]).filter((e=>e.choice)).lenght},getData(){const e=Object.values(JSON.parse(JSON.stringify(this.choiceProduct))).map((e=>{const t={productUniqueId:e.uniqueId,camPolicyList:[]};return e.role.forEach((e=>{e.choice&&t.camPolicyList.push({policyCode:e.policyCode,policyUniqueId:e.policyUniqueId,id:e.id})})),t}));return e},clickRole(e){this.$set(e,"choice",!e.choice)},updateProduct(e){const t=e.uniqueId;this.choiceProduct[t]||(e.role?this.$set(this.choiceProduct,t,{cname:e.cname,uniqueId:t,role:e.role}):(0,a.Z)({url:this.api["listByProdUniqueld"][0],method:this.api["listByProdUniqueld"][1],params:{productUniqueId:t}}).then((({data:{list:r}})=>{this.$set(e,"role",r),this.$set(this.choiceProduct,t,{cname:e.cname,uniqueId:t,role:r})}))),this.choiceUniqueId=t}},created(){this.api=JSON.parse(this.menu.apiJson)}},s=o,c=r(1001),u=(0,c.Z)(s,i,n,!1,null,"1273ccd8",null),l=u.exports},78249:function(e,t,r){(function(t,r){e.exports=r()})(0,(function(){var e=e||function(e,t){var i;if("undefined"!==typeof window&&window.crypto&&(i=window.crypto),"undefined"!==typeof self&&self.crypto&&(i=self.crypto),"undefined"!==typeof globalThis&&globalThis.crypto&&(i=globalThis.crypto),!i&&"undefined"!==typeof window&&window.msCrypto&&(i=window.msCrypto),!i&&"undefined"!==typeof r.g&&r.g.crypto&&(i=r.g.crypto),!i)try{i=r(42480)}catch(g){}var n=function(){if(i){if("function"===typeof i.getRandomValues)try{return i.getRandomValues(new Uint32Array(1))[0]}catch(g){}if("function"===typeof i.randomBytes)try{return i.randomBytes(4).readInt32LE()}catch(g){}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),o={},s=o.lib={},c=s.Base=function(){return{extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),u=s.WordArray=c.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var a=0;a<n;a++){var o=r[a>>>2]>>>24-a%4*8&255;t[i+a>>>2]|=o<<24-(i+a)%4*8}else for(var s=0;s<n;s+=4)t[i+s>>>2]=r[s>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new u.init(t,e)}}),l=o.enc={},d=l.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var a=t[n>>>2]>>>24-n%4*8&255;i.push((a>>>4).toString(16)),i.push((15&a).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new u.init(r,t/2)}},p=l.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],n=0;n<r;n++){var a=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(a))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new u.init(r,t)}},f=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},h=s.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,i=this._data,n=i.words,a=i.sigBytes,o=this.blockSize,s=4*o,c=a/s;c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0);var l=c*o,d=e.min(4*l,a);if(l){for(var p=0;p<l;p+=o)this._doProcessBlock(n,p);r=n.splice(0,l),i.sigBytes-=d}return new u.init(r,d)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(s.Hasher=h.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new m.HMAC.init(e,r).finalize(t)}}}),o.algo={});return o}(Math);return e}))},98269:function(e,t,r){(function(t,i){e.exports=i(r(78249))})(0,(function(e){return function(){var t=e,r=t.lib,i=r.WordArray,n=t.enc;n.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,i=this._map;e.clamp();for(var n=[],a=0;a<r;a+=3)for(var o=t[a>>>2]>>>24-a%4*8&255,s=t[a+1>>>2]>>>24-(a+1)%4*8&255,c=t[a+2>>>2]>>>24-(a+2)%4*8&255,u=o<<16|s<<8|c,l=0;l<4&&a+.75*l<r;l++)n.push(i.charAt(u>>>6*(3-l)&63));var d=i.charAt(64);if(d)while(n.length%4)n.push(d);return n.join("")},parse:function(e){var t=e.length,r=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var n=0;n<r.length;n++)i[r.charCodeAt(n)]=n}var o=r.charAt(64);if(o){var s=e.indexOf(o);-1!==s&&(t=s)}return a(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function a(e,t,r){for(var n=[],a=0,o=0;o<t;o++)if(o%4){var s=r[e.charCodeAt(o-1)]<<o%4*2,c=r[e.charCodeAt(o)]>>>6-o%4*2,u=s|c;n[a>>>2]|=u<<24-a%4*8,a++}return i.create(n,a)}}(),e.enc.Base64}))},55743:function(e,t,r){(function(t,i){e.exports=i(r(78249))})(0,(function(e){return e.enc.Utf8}))},99534:function(e,t,r){"use strict";r.d(t,{Ch:function(){return u},Dz:function(){return n},JV:function(){return p},SP:function(){return l},Sy:function(){return d},XY:function(){return h},_d:function(){return o},fI:function(){return f},gj:function(){return c},s8:function(){return a},ul:function(){return s}});var i=r(56414);function n(e){return(0,i.Z)({method:"get",url:"auth/business/list",params:e})}function a(e){return(0,i.Z)({method:"get",url:"auth/camPolicy/detail",params:e})}function o(e){return(0,i.Z)({method:"post",url:"auth/camPolicy/save",data:e})}function s(e){return(0,i.Z)({method:"post",url:"auth/camPolicy/update",data:e})}function c(e){return(0,i.Z)({method:"post",url:"auth/camPolicyDataTag/save",data:e})}function u(e){return(0,i.Z)({method:"post",url:"auth/camPolicy/v2/policyDataTagList",data:e})}function l(e){return(0,i.Z)({method:"post",url:"auth/camPolicy/v2/policyDetail",data:e})}function d(e){return(0,i.Z)({method:"post",url:"auth/camPolicy/savePolicy",data:e})}function p(e){return(0,i.Z)({method:"get",url:"auth/camPolicy/list",params:e})}function f(e){return(0,i.Z)({method:"get",url:"auth/user/getUserErrorCount",isJSON:!1,params:e})}function h(e){return(0,i.Z)({method:"post",url:"auth/user/clearCache",isJSON:!1,params:e})}},42480:function(){}}]);
//# sourceMappingURL=323.2d005823.js.map