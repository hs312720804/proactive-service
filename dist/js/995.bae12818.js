"use strict";(self["webpackJsonp_proactiveServiceSaas"]=self["webpackJsonp_proactiveServiceSaas"]||[]).push([[995],{62653:function(e,t,a){a.d(t,{Z:function(){return p}});var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"tags-rule-wrapper"},[e.tagList&&e.tagList.length>0?[t("div",{directives:[{name:"show",rawName:"v-show",value:e.renderJson.rules.length>1,expression:"renderJson.rules.length > 1"}],key:e.parentIndex+"or",staticClass:"label-or-space"},[t("el-button",{key:"button2_"+e.parentIndex,attrs:{type:"success",round:""},on:{click:function(t){return e.handleRulesConditionChange(e.renderJson)}}},[e._v(" "+e._s("AND"===e.renderJson.condition?"且":"或")+" ")])],1),e._l(e.renderJson.rules,(function(a,n){return[t("div",{key:e.parentIndex+"_"+n,staticClass:"label-ground"},[t("div",{staticClass:"tag-condition--parent"},[t("div",{directives:[{name:"show",rawName:"v-show",value:a.rules.length>1,expression:"item.rules.length > 1"}],staticClass:"tag-condition"},[t("el-button",{key:"button"+n+"_"+e.parentIndex,attrs:{type:"warning",round:"",size:"small"},on:{click:function(t){return e.handleRulesConditionChange(a)}}},[e._v(" "+e._s("AND"===a.condition?"且":"或")+" ")])],1),e._l(a.rules,(function(i,l){return t("div",{key:n+"tagId"+l,class:{"label-item":!0,paddingTop:l>0}},["button_click"===i.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(i.tagName))]),t("el-select",{key:l+"dialogue",staticStyle:{width:"130px"},attrs:{filterable:"",clearable:"",placeholder:"请选择对话框"},on:{change:function(t){return e.getDialogueButtonList(i,{needClear:!0})}},model:{value:i.dialogueNodeId,callback:function(t){e.$set(i,"dialogueNodeId",t)},expression:"childItem.dialogueNodeId"}},[e.cache[i.tagKey]?e._l(e.cache[i.tagKey].list,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})):e._e()],2),i.dialogueNodeId?t("el-select",{key:l+"button",staticStyle:{width:"150px","margin-left":"5px"},attrs:{filterable:"",clearable:"",placeholder:"请选择按钮"},model:{value:i.buttonId,callback:function(t){e.$set(i,"buttonId",t)},expression:"childItem.buttonId"}},[e.cache[i.tagKey+"_button"]?e._l(e.cache[i.tagKey+"_button"].list,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id.toString(),label:e.name}})})):e._e()],2):e._e(),t("el-select",{staticClass:"input-inline",staticStyle:{width:"80px"},attrs:{name:"oxve"},model:{value:i.operator,callback:function(t){e.$set(i,"operator",t)},expression:"childItem.operator"}},[t("el-option",{attrs:{value:"="}}),t("el-option",{attrs:{value:">="}}),t("el-option",{attrs:{value:"<="}}),t("el-option",{attrs:{value:">"}}),t("el-option",{attrs:{value:"<"}})],1),i.dialogueNodeId&&i.buttonId?t("el-input",{staticClass:"short-input",model:{value:i.count,callback:function(t){e.$set(i,"count",t)},expression:"childItem.count"}}):e._e(),i.dialogueNodeId&&i.buttonId?t("span",{staticClass:"txt end-text"},[e._v(e._s(e.getTagUnit(i.tagKey))+" ")]):e._e()]:"dialog_show"===i.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(i.tagName))]),t("el-select",{key:l+"-dialogue-show"+n,staticStyle:{width:"130px"},attrs:{filterable:"",clearable:"",placeholder:"请选择对话框"},model:{value:i.showDialogueNodeId,callback:function(t){e.$set(i,"showDialogueNodeId",t)},expression:"childItem.showDialogueNodeId"}},[e.cache["button_click"]?e._l(e.cache["button_click"].list,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})):e._e()],2),t("el-select",{staticClass:"input-inline",staticStyle:{width:"80px"},attrs:{name:"oxve"},model:{value:i.operator,callback:function(t){e.$set(i,"operator",t)},expression:"childItem.operator"}},[t("el-option",{attrs:{value:"="}}),t("el-option",{attrs:{value:">="}}),t("el-option",{attrs:{value:"<="}}),t("el-option",{attrs:{value:">"}}),t("el-option",{attrs:{value:"<"}})],1),i.showDialogueNodeId?t("el-input",{staticClass:"short-input",model:{value:i.showCount,callback:function(t){e.$set(i,"showCount",t)},expression:"childItem.showCount"}}):e._e(),i.showDialogueNodeId?t("span",{staticClass:"txt end-text"},[e._v(e._s(e.getTagUnit(i.tagKey))+" ")]):e._e()]:"attr_match"===i.inputType?[t("span",{staticClass:"txt"},[e._v(e._s(i.tagName))]),t("el-select",{key:l+"-dialogue-show"+n,staticStyle:{width:"130px"},attrs:{filterable:"",clearable:"",placeholder:"请选择属性值"},model:{value:i.tagKey,callback:function(t){e.$set(i,"tagKey",t)},expression:"childItem.tagKey"}},[e.cache["attr_match"]?e._l(e.cache["attr_match"].list,(function(e){return t("el-option",{key:e.attrId,attrs:{value:e.attrKey,label:e.attrName}})})):e._e()],2),t("el-select",{staticClass:"input-inline",staticStyle:{width:"80px"},attrs:{name:"oxve"},model:{value:i.operator,callback:function(t){e.$set(i,"operator",t)},expression:"childItem.operator"}},[t("el-option",{attrs:{value:"="}}),t("el-option",{attrs:{value:">="}}),t("el-option",{attrs:{value:"<="}}),t("el-option",{attrs:{value:">"}}),t("el-option",{attrs:{value:"<"}})],1),t("el-input",{staticClass:"short-input",model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"childItem.value"}})]:"sleep_time"===i.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(i.tagName))]),t("el-select",{key:l+i.tagKey,staticStyle:{width:"80px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"childItem.value"}},e._l([{id:"1",name:"是"},{id:"0",name:"否"}],(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)]:"dmp_crowd"===i.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(i.tagName))]),t("el-select",{key:l+i.tagKey,staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"childItem.value"}},[e.cache[i.tagKey]?e._l(e.cache[i.tagKey].list,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})):e._e()],2)]:"event_hit"===i.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(i.tagName))]),t("el-select",{key:l+i.tagKey,staticStyle:{width:"130px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"childItem.value"}},[e.cache[i.tagKey]?e._l(e.cache[i.tagKey].list,(function(e){return t("el-option",{key:e.eventCode,attrs:{value:e.eventCode,label:e.eventName}})})):e._e()],2)]:"time_hit"===i.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(i.tagName))]),t("el-select",{key:l+i.tagKey,staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",placeholder:"请选择时间类型"},model:{value:i.type,callback:function(t){e.$set(i,"type",t)},expression:"childItem.type"}},e._l([{type:1,name:"固定时间"},{type:2,name:"推理时间"},{type:3,name:"时间区间"},{type:4,name:"区间推理时间"}],(function(e){return t("el-option",{key:e.type,attrs:{value:e.type,label:e.name}})})),1),1===i.type?t("el-time-picker",{staticStyle:{"margin-left":"5px"},attrs:{"value-format":"HH:mm:ss",placeholder:"选择时间"},model:{value:i.staticTimeVal,callback:function(t){e.$set(i,"staticTimeVal",t)},expression:"childItem.staticTimeVal"}}):2===i.type?t("el-select",{key:l+i.tagKey+i.type,staticStyle:{width:"150px","margin-left":"5px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:i.inferenceTimeVal,callback:function(t){e.$set(i,"inferenceTimeVal",t)},expression:"childItem.inferenceTimeVal"}},e._l([{id:1,name:i.type+"_[sleep_time]",cname:i.type+"_睡觉时间"}],(function(e){return t("el-option",{key:e.id,attrs:{value:e.name,label:e.cname}})})),1):3===i.type?[t("el-time-picker",{staticStyle:{"margin-left":"5px"},attrs:{placeholder:"选择开始时间","value-format":"HH:mm:ss"},model:{value:i.intervalStartVal,callback:function(t){e.$set(i,"intervalStartVal",t)},expression:"childItem.intervalStartVal"}}),t("span",{staticStyle:{color:"#666","margin-left":"2px","margin-right":"2px"}},[e._v("-")]),t("el-time-picker",{staticStyle:{"margin-left":"5px"},attrs:{placeholder:"选择结束时间","value-format":"HH:mm:ss"},model:{value:i.intervalEndVal,callback:function(t){e.$set(i,"intervalEndVal",t)},expression:"childItem.intervalEndVal"}})]:4===i.type?[t("el-select",{key:l+i.tagKey+i.type+"region-type",staticStyle:{width:"150px","margin-left":"5px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:i.inferRegionStartVal,callback:function(t){e.$set(i,"inferRegionStartVal",t)},expression:"childItem.inferRegionStartVal"}},e._l([{id:1,name:"silenceBootBeginTime",cname:"静音开机开始时间"}],(function(e){return t("el-option",{key:e.id,attrs:{value:e.name,label:e.cname}})})),1),t("span",{staticStyle:{color:"#666"}},[e._v("-")]),t("el-select",{key:l+i.tagKey+i.type,staticStyle:{width:"150px","margin-left":"5px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:i.inferRegionEndVal,callback:function(t){e.$set(i,"inferRegionEndVal",t)},expression:"childItem.inferRegionEndVal"}},e._l([{id:1,name:"silenceBootEndTime",cname:"静音开机结束时间"}],(function(e){return t("el-option",{key:e.id,attrs:{value:e.name,label:e.cname}})})),1)]:e._e()]:[t("span",{staticClass:"txt"},[e._v(e._s(i.tagName))]),t("el-select",{key:l+i.tagKey,staticStyle:{width:"80px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"childItem.value"}},e._l([{id:"1",name:"是"},{id:"0",name:"否"}],(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],t("span",{staticClass:"i",on:{click:function(t){return e.handleRemoveRule(a,i)}}},[t("i",{staticClass:"icon iconfont el-icon-cc-delete"})])],2)})),t("div",{staticClass:"label-add"},[t("div",{staticClass:"optional-condition"},e._l(e.tagList,(function(n){return t("el-tag",{key:n.tagKey,staticClass:"oc-item",attrs:{type:e.dataSourceColorEnum[n.dataSource]},nativeOn:{click:function(t){return e.handleAddChildRule(a,n)}}},[e._v(e._s(n.tagName)+" ")])})),1)])],2)])]})),t("div",{staticClass:"label-or"},[e.tagList.length?t("div",{staticClass:"optional-condition",style:{"padding-top":e.renderJson.rules.length>0?"10px":0}},[e._l(e.tagList,(function(a){return t("el-tag",{key:a.tagName,staticClass:"oc-item",attrs:{type:e.dataSourceColorEnum[a.dataSource]},nativeOn:{click:function(t){return e.handleAddRule(a)}}},[e._v(e._s(a.tagName)+" ")])})),e.showHitTip?t("div",{staticClass:"introjs-hint",staticStyle:{"font-size":"28px",position:"absolute",bottom:"-28px",left:"20px",color:"#999"}},[t("i",{staticClass:"el-icon-thumb",staticStyle:{"font-size":"18px"}}),t("span",{staticStyle:{"font-size":"12px"}},[e._v("点击标签来编辑人群条件")])]):e._e()],2):e._e()])]:e._e()],2)},i=[];a(57658);const l={1:"success",2:"danger",3:"",5:"warning",6:"warningOrange",7:"warningOrange2",8:"warningCyan",11:"success",12:"gray",12.2:"gray",13:"pink"};var r=a(49130),o=a(66770),s={inject:["serviceId"],props:{tagList:{type:Array,default:()=>[]},ruleJson:{type:Object,default:()=>({})},parentIndex:{type:Number,default:0},tagIds:{type:Array,default:()=>[]},serviceId:{type:Number}},data(){return{showHitTip:!0,cache:{},versionId:"",renderJson:{rules:[]}}},computed:{dataSourceColorEnum(){return l}},watch:{ruleJson:{handler(e){this.renderJson=e},immediate:!0}},methods:{handleRemoveRule(e,t){const a=this.renderJson;e.rules.splice(e.rules.indexOf(t),1),0===e.rules.length&&(a.rules=a.rules.filter((function(t){return t!==e})))},transformSaveRules(){function e(e){return e.substring(0,e.lastIndexOf(":")+1)+"00"}this.renderJson.rules.forEach((t=>{t.rules.forEach(((t,a)=>{if("button_click"===t.tagKey){const e=t.dialogueNodeId||"null",a=t.buttonId||"null",n=t.count.toString()||"null";t.value=`${e}_${a}_${n}`}else if("dialog_show"===t.tagKey){const e=t.showDialogueNodeId||"null",a=t.showCount.toString()||"null";t.value=`${e}_${a}`}else if("time_hit"===t.tagKey){if(1===t.type){t.staticTimeVal;t.value=`${t.type}_${e(t.staticTimeVal)}`}else if(2===t.type){const e=t.inferenceTimeVal||"null";t.value=e}else if(3===t.type){const a=t.intervalStartVal||"null",n=t.intervalEndVal||"null";t.value=`${t.type}_${e(a)}-${e(n)}`}else if(4===t.type){const e=t.inferRegionStartVal||"null",a=t.inferRegionEndVal||"null";t.value=`${t.type}_[${e}]-[${a}]`}}else t.value=t.value.toString()}))})),this.$emit("update:ruleJson",this.renderJson)},getTagUnit(e){return this.$props.tagList.find(((t,a)=>t.tagKey===e))?.tagUnit||""},async getCrowdList(e){try{const t=await(0,o.Rd)({});1e3===t.code&&this.$set(this.cache,e,{list:t.data.map((e=>({...e,id:`${e.policyId}_${e.crowdId}`,name:`${e.crowdId}_${e.crowdName}`})))||[]})}catch(t){console.error("getCrowdList error: ",t)}},async getDialogueList(e){try{const t=await(0,o.ZE)({versionId:this.versionId});1e3===t.code&&this.$set(this.cache,e,{list:t.data||[]})}catch(t){console.error("getDialogueList error: ",t)}},async getAttrMatchEventList(e){try{const t=await(0,r.EC)();1e3===t.code&&this.$set(this.cache,e,{list:t.data||[]})}catch(t){console.error("getDialogueList error: ",t)}},async getDialogueButtonList(e,t){const{dialogueNodeId:a,tagKey:n}=e;t&&t?.needClear&&(e.buttonId="",e.count=""),console.debug("getButtonList: ",a,n);try{const e=await(0,o.gL)({nodeId:a});1e3===e.code&&this.$set(this.cache,`${n}_button`,{list:e.data||[]})}catch(i){console.error("getDialogueButtonList error: ",i)}},async getUserEventList(e){try{const t=await(0,o.o$)({});1e3===t.code&&this.$set(this.cache,e,{list:t.data||[]})}catch(t){console.error("getUserEventList error: ",t)}},handleRulesConditionChange(e){e.condition="AND"===e.condition?"OR":"AND"},fetchTagSuggestions(e){const{tagKey:t}=e;switch(t){case"dmp_crowd":this.getCrowdList(t);break;case"button_click":this.getDialogueList(t);break;case"dialog_show":this.getDialogueList("button_click");break;case"event_hit":this.getUserEventList(t);break;case"attr_match":this.getAttrMatchEventList(t);break;default:break}},async getVersionId(){try{const e=await(0,r.rT)({serviceId:this.serviceId||this.$props.serviceId});1e3===e.code&&(this.versionId=e.data)}catch(e){console.error("getVersionId error: ",e)}},getDynamicTagRuleInfo(e){const{tagId:t,tagKey:a}=e;let n=null;switch(a){case"button_click":n={dialogueNodeId:"",buttonId:"",count:0};break;case"dialog_show":n={showDialogueNodeId:"",showCount:0};break;case"time_hit":n={type:1,time:"",staticTimeVal:"",inferenceTimeVal:"",intervalStartVal:"",intervalEndVal:"",inferRegionStartVal:"",inferRegionEndVal:""};break;default:break}return n},initTagsSuggestions(){const e=["button_click","dialog_show","dmp_crowd","event_hit","attr_match"];e.forEach((e=>{this.fetchTagSuggestions({tagKey:e})}))},handleAddRule(e){console.debug("addRule: ",e),this.showHitTip=!1,this.renderJson.rules.length>50&&this.$message({message:"已达最大数量",type:"error"});const t=["button_click","dialog_show","dmp_crowd","event_hit"];t.includes(e.tagKey)&&(this.cache[e.tagKey]||this.fetchTagSuggestions(e));let a="";a=["button_click","dialog_show"].includes(e.tagKey)?">=":"=",this.renderJson.rules.push({condition:"AND",rules:[{dataSource:e.dataSource,inputType:e.inputType,tagId:e.tagId,tagKey:e.tagKey,tagType:e.tagType,tagName:e.tagName,operator:a,value:"",...this.getDynamicTagRuleInfo(e)}]}),console.debug("handleAddRule cache: ",this.cache)},handleAddChildRule(e,t){if(console.debug("handleAddChildRule: ",e,t),e.rules.length>=50)return void this.$message({type:"error",message:"已达最大数量"});const a=["button_click","dialog_show","dmp_crowd","event_hit"];a.includes(t.tagKey)&&(this.cache[t.tagKey]||this.fetchTagSuggestions(t));let n="";n=["button_click","dialog_show"].includes(t.tagKey)?">=":"=",e.rules.push({dataSource:t.dataSource,inputType:t.inputType,tagId:t.tagId,tagKey:t.tagKey,tagType:t.tagType,tagName:t.tagName,operator:n,value:"",...this.getDynamicTagRuleInfo(t)}),console.debug("handleAddChildRule cache: ",this.cache)},initDynamicData(){this.renderJson.rules.forEach((e=>{e.rules.forEach(((e,t)=>{switch(e.tagKey){case"button_click":this.getDialogueButtonList(e,{needClear:!1});break;default:break}}))}))}},async mounted(){},async created(){await this.getVersionId(),this.initTagsSuggestions(),this.initDynamicData()}},c=s,u=a(1001),d=(0,u.Z)(c,n,i,!1,null,"2d0f8262",null),p=d.exports},49130:function(e,t,a){a.d(t,{AZ:function(){return g},EC:function(){return y},LS:function(){return s},Me:function(){return o},OY:function(){return c},Xr:function(){return r},cK:function(){return d},ce:function(){return u},hj:function(){return l},jn:function(){return f},lw:function(){return m},o:function(){return i},oY:function(){return p},rT:function(){return h}});var n=a(56414);function i(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/node/start/get",params:e})}function l(e){return(0,n.Z)({method:"post",url:"proactive_admin_api/interactify/node/start/update",data:e})}function r(e){return(0,n.Z)({method:"post",url:"proactive_admin_api/interactify/node/assert/add",data:e})}function o(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/node/assert/get",params:e})}function s(e){return(0,n.Z)({method:"post",url:"proactive_admin_api/interactify/node/assert/update",data:e})}function c(e){return(0,n.Z)({method:"delete",url:"proactive_admin_api/interactify/node/del",params:e})}function u(e){return(0,n.Z)({method:"post",url:"proactive_admin_api/interactify/node/dialog/add",data:e})}function d(e){return(0,n.Z)({method:"post",url:"proactive_admin_api/interactify/node/end/add",data:e})}function p(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/node/dialog/get",params:e})}function g(e){return(0,n.Z)({method:"post",url:"proactive_admin_api/interactify/node/dialog/update",data:e})}function m(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/node/tree/get",params:e})}function h(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/node/versionId",params:e})}function f(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/node/select",params:e})}function y(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/tag/attr",params:e})}},23304:function(e,t,a){a.d(t,{FS:function(){return u},Or:function(){return l},Pu:function(){return p},Q4:function(){return s},UE:function(){return c},X_:function(){return d},eK:function(){return o},lo:function(){return i},mr:function(){return r},v4:function(){return g}});var n=a(56414);function i(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/service/list",params:e})}function l(e){return(0,n.Z)({method:"post",url:"proactive_admin_api/interactify/service/add",data:e})}function r(e){return(0,n.Z)({method:"delete",url:"proactive_admin_api/interactify/service/del",params:e})}function o(e){return(0,n.Z)({method:"post",url:"proactive_admin_api/interactify/service/online",params:e})}function s(e){return(0,n.Z)({method:"post",url:"proactive_admin_api/interactify/service/offline",params:e})}function c(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/service/get",params:e})}function u(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/node/bar/title",params:e})}function d(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/node/reset",params:e})}function p(e){return(0,n.Z)({method:"post",url:"proactive_admin_api/interactify/service/update",data:e})}function g(e){return(0,n.Z)({method:"post",url:"proactive_admin_api/file/upload",headers:{"Content-Type":"multipart/form-data"},data:e})}},66770:function(e,t,a){a.d(t,{G0:function(){return i},Rd:function(){return l},ZE:function(){return r},gL:function(){return o},o$:function(){return s}});var n=a(56414);function i(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/tag/list",params:e})}function l(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/setting/admin/crowd/list",params:e})}function r(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/tag/node",params:e})}function o(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/interactify/tag/button",params:e})}function s(e){return(0,n.Z)({method:"get",url:"proactive_admin_api/scene/event/list",params:e})}}}]);
//# sourceMappingURL=995.bae12818.js.map