"use strict";(self["webpackJsonp_proactiveServiceSaas"]=self["webpackJsonp_proactiveServiceSaas"]||[]).push([[569],{41708:function(e,t,a){a.d(t,{Z:function(){return p}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"tags-rule-wrapper"},[[t("div",{directives:[{name:"show",rawName:"v-show",value:e.ruleJson.rules.length>1,expression:"ruleJson.rules.length > 1"}],key:e.parentIndex+"or",staticClass:"label-or-space"},[t("el-button",{key:"button2_"+e.parentIndex,attrs:{type:"success",round:""},on:{click:function(t){return e.handleRulesConditionChange(e.ruleJson)}}},[e._v(" "+e._s("AND"===e.ruleJson.condition?"且":"或")+" ")])],1),e._l(e.ruleJson.rules,(function(a,i){return[t("div",{key:e.parentIndex+"_"+i,staticClass:"label-ground"},[t("div",{staticClass:"tag-condition--parent"},[t("div",{directives:[{name:"show",rawName:"v-show",value:a.rules.length>1,expression:"item.rules.length > 1"}],staticClass:"tag-condition"},[t("el-button",{key:"button"+i+"_"+e.parentIndex,attrs:{type:"warning",round:"",size:"small"},on:{click:function(t){return e.handleRulesConditionChange(a)}}},[e._v(" "+e._s("AND"===a.condition?"且":"或")+" ")])],1),e._l(a.rules,(function(n,l){return t("div",{key:i+"tagId"+l,class:{"label-item":!0,paddingTop:l>0}},["button_click"===n.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(n.tagName))]),e.cache[n.tagKey].list?t("el-select",{key:l+"dialogue",staticStyle:{width:"130px"},attrs:{filterable:"",clearable:"",placeholder:"请选择对话框"},on:{change:function(t){return e.getDialogueButtonList(n.dialogueNodeId,n.tagKey)}},model:{value:n.dialogueNodeId,callback:function(t){e.$set(n,"dialogueNodeId",t)},expression:"childItem.dialogueNodeId"}},e._l(e.cache[n.tagKey].list,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1):e._e(),n.dialogueNodeId?t("el-select",{key:l+"button",staticStyle:{width:"150px","margin-left":"5px"},attrs:{filterable:"",clearable:"",placeholder:"请选择按钮"},model:{value:n.buttonId,callback:function(t){e.$set(n,"buttonId",t)},expression:"childItem.buttonId"}},e._l(e.cache[n.tagKey+"_button"].list,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id.toString(),label:e.name}})})),1):e._e(),n.dialogueNodeId&&n.buttonId?t("el-input",{staticClass:"short-input",attrs:{size:"mini"},model:{value:n.count,callback:function(t){e.$set(n,"count",t)},expression:"childItem.count"}}):e._e(),n.dialogueNodeId&&n.buttonId?t("span",{staticClass:"txt end-text"},[e._v(e._s(e.getTagUnit(n.tagKey))+" ")]):e._e()]:"dialog_show"===n.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(n.tagName))]),t("el-select",{key:l+"-dialogue-show",staticStyle:{width:"130px"},attrs:{filterable:"",clearable:"",placeholder:"请选择对话框"},model:{value:n.showDialogueNodeId,callback:function(t){e.$set(n,"showDialogueNodeId",t)},expression:"childItem.showDialogueNodeId"}},e._l(e.cache["button_click"].list,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),n.showDialogueNodeId?t("el-input",{staticClass:"short-input",attrs:{size:"mini"},model:{value:n.showCount,callback:function(t){e.$set(n,"showCount",t)},expression:"childItem.showCount"}}):e._e(),n.showDialogueNodeId?t("span",{staticClass:"txt end-text"},[e._v(e._s(e.getTagUnit(n.tagKey))+" ")]):e._e()]:"sleep_time"===n.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(n.tagName))]),t("el-select",{key:l+n.tagKey,staticStyle:{width:"80px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"childItem.value"}},e._l([{id:1,name:"是"},{id:0,name:"否"}],(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)]:"dmp_crowd"===n.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(n.tagName))]),t("el-select",{key:l+n.tagKey,staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"childItem.value"}},e._l(e.cache[n.tagKey].list,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)]:"event_hit"===n.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(n.tagName))]),t("el-select",{key:l+n.tagKey,staticStyle:{width:"130px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"childItem.value"}},e._l(e.cache[n.tagKey].list,(function(e){return t("el-option",{key:e.eventCode,attrs:{value:e.eventCode,label:e.eventName}})})),1)]:"time_hit"===n.tagKey?[t("span",{staticClass:"txt"},[e._v(e._s(n.tagName))]),t("el-select",{key:l+n.tagKey,staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",placeholder:"请选择时间类型"},model:{value:n.type,callback:function(t){e.$set(n,"type",t)},expression:"childItem.type"}},e._l([{type:1,name:"固定时间"},{type:2,name:"推理时间"},{type:3,name:"时间区间"},{type:4,name:"区间推理时间"}],(function(e){return t("el-option",{key:e.type,attrs:{value:e.type,label:e.name}})})),1),1===n.type?t("el-time-picker",{staticStyle:{"margin-left":"5px"},attrs:{"value-format":"HH:mm:ss",placeholder:"选择时间"},model:{value:n.staticTimeVal,callback:function(t){e.$set(n,"staticTimeVal",t)},expression:"childItem.staticTimeVal"}}):2===n.type?t("el-select",{key:l+n.tagKey+n.type,staticStyle:{width:"150px","margin-left":"5px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:n.inferenceTimeVal,callback:function(t){e.$set(n,"inferenceTimeVal",t)},expression:"childItem.inferenceTimeVal"}},e._l([{id:1,name:n.type+"_[sleep_time]",cname:n.type+"_睡觉时间"}],(function(e){return t("el-option",{key:e.id,attrs:{value:e.name,label:e.cname}})})),1):3===n.type?t("el-time-picker",{staticStyle:{"margin-left":"5px"},attrs:{"is-range":"","value-format":"HH:mm:ss","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",placeholder:"选择时间范围"},model:{value:n.intervalTimeVal,callback:function(t){e.$set(n,"intervalTimeVal",t)},expression:"childItem.intervalTimeVal"}}):4===n.type?[t("el-select",{key:l+n.tagKey+n.type+"region-type",staticStyle:{width:"150px","margin-left":"5px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:n.inferRegionStartVal,callback:function(t){e.$set(n,"inferRegionStartVal",t)},expression:"childItem.inferRegionStartVal"}},e._l([{id:1,name:"silenceBootBeginTime",cname:"静音开机开始时间"}],(function(e){return t("el-option",{key:e.id,attrs:{value:e.name,label:e.cname}})})),1),t("span",{staticStyle:{color:"#666"}},[e._v("-")]),t("el-select",{key:l+n.tagKey+n.type,staticStyle:{width:"150px","margin-left":"5px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:n.inferRegionEndVal,callback:function(t){e.$set(n,"inferRegionEndVal",t)},expression:"childItem.inferRegionEndVal"}},e._l([{id:1,name:"silenceBootEndTime",cname:"静音开机结束时间"}],(function(e){return t("el-option",{key:e.id,attrs:{value:e.name,label:e.cname}})})),1)]:e._e()]:[t("span",{staticClass:"txt"},[e._v(e._s(n.tagName))]),t("el-select",{key:l+n.tagKey,staticStyle:{width:"80px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"childItem.value"}},e._l([{id:"1",name:"是"},{id:"0",name:"否"}],(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],t("span",{staticClass:"i",on:{click:function(t){return e.handleRemoveRule(a,n)}}},[t("i",{staticClass:"icon iconfont el-icon-cc-delete"})])],2)})),t("div",{staticClass:"label-add"},[t("div",{staticClass:"optional-condition"},e._l(e.tagList,(function(i){return t("el-tag",{key:i.tagItem,staticClass:"oc-item",attrs:{type:e.dataSourceColorEnum[i.dataSource]},nativeOn:{click:function(t){return e.handleAddChildRule(a,i)}}},[e._v(e._s(i.tagName)+" ")])})),1)])],2)])]})),t("div",{staticClass:"label-or"},[e.tagList.length?t("div",{staticClass:"optional-condition",style:{"padding-top":e.ruleJson.rules.length>0?"10px":0}},[e._l(e.tagList,(function(a){return t("el-tag",{key:a.tagName,staticClass:"oc-item",attrs:{type:e.dataSourceColorEnum[a.dataSource]},nativeOn:{click:function(t){return e.handleAddRule(a)}}},[e._v(e._s(a.tagName)+" ")])})),e.showHitTip?t("div",{staticClass:"introjs-hint",staticStyle:{"font-size":"28px",position:"absolute",bottom:"-28px",left:"20px",color:"#999"}},[t("i",{staticClass:"el-icon-thumb",staticStyle:{"font-size":"18px"}}),t("span",{staticStyle:{"font-size":"12px"}},[e._v("点击标签来编辑人群条件")])]):e._e()],2):e._e()])]],2)},n=[];a(57658);const l={1:"success",2:"danger",3:"",5:"warning",6:"warningOrange",7:"warningOrange2",8:"warningCyan",11:"success",12:"gray",12.2:"gray",13:"pink"};var o=a(49130),r=a(66770),s={inject:["serviceId"],props:{tagList:{type:Array,default:()=>[]},ruleJson:{type:Object,default:()=>({})},parentIndex:{type:Number,default:0},tagIds:{type:Array,default:()=>[]},serviceId:{type:Number}},data(){return{showHitTip:!0,cache:{},versionId:""}},computed:{dataSourceColorEnum(){return l}},watch:{},methods:{handleRemoveRule(e,t){const a=this.$props.ruleJson;e.rules.splice(e.rules.indexOf(t),1),0===e.rules.length&&(a.rules=a.rules.filter((function(t){return t!==e})))},transformSaveRules(){this.$props.ruleJson.rules.forEach((e=>{e.rules.forEach(((e,t)=>{if("button_click"===e.tagKey){const t=e.dialogueNodeId||"null",a=e.buttonId||"null",i=e.count.toString()||"null";e.value=`${t}_${a}_${i}`}else if("dialog_show"===e.tagKey){const t=e.showDialogueNodeId||"null",a=e.showCount.toString()||"null";e.value=`${t}_${a}`}else if("time_hit"===e.tagKey){if(1===e.type){e.staticTimeVal;e.value=`${e.type}_${e.staticTimeVal}`}else if(2===e.type){const t=e.inferenceTimeVal||"null";e.value=t}else if(3===e.type){e.intervalTimeVal;if(Array.isArray(e.intervalTimeVal)&&e.intervalTimeVal.length>0){const t=e.intervalTimeVal.join("-");e.value=`${e.type}_${t}`}else e.value=`${e.type}_null`}else if(4===e.type){const t=e.inferRegionStartVal||"null",a=e.inferRegionEndVal||"null";e.value=`${e.type}_[${t}]-[${a}]`}}else e.value=e.value.toString()}))})),this.$emit("update:ruleJson",this.$props.ruleJson)},getTagUnit(e){return this.$props.tagList.find(((t,a)=>t.tagKey===e))?.tagUnit||""},async getCrowdList(e){try{const t=await(0,r.Rd)({});1e3===t.code&&this.$set(this.cache,e,{list:t.data.map((e=>({...e,id:`${e.policyId}_${e.crowdId}`,name:`${e.crowdId}_${e.crowdName}`})))})}catch(t){console.error("getCrowdList error: ",t)}},async getDialogueList(e){try{const t=await(0,r.ZE)({versionId:this.versionId});1e3===t.code&&this.$set(this.cache,e,{list:t.data})}catch(t){console.error("getDialogueList error: ",t)}},async getDialogueButtonList(e,t){console.debug("getButtonList: ",e,t);try{const a=await(0,r.gL)({nodeId:e});1e3===a.code&&this.$set(this.cache,`${t}_button`,{list:a.data})}catch(a){console.error("getDialogueButtonList error: ",a)}},async getUserEventList(e){try{const t=await(0,r.o$)({});1e3===t.code&&this.$set(this.cache,e,{list:t.data})}catch(t){console.error("getUserEventList error: ",t)}},handleRulesConditionChange(e){e.condition="AND"===e.condition?"OR":"AND"},fetchTagSuggestions(e){const{tagKey:t}=e;switch(t){case"dmp_crowd":this.getCrowdList(t);break;case"button_click":this.getDialogueList(t);break;case"dialog_show":this.getDialogueList("button_click");break;case"event_hit":this.getUserEventList(t);break;default:break}},async getVersionId(){try{const e=await(0,o.rT)({serviceId:this.serviceId||this.$props.serviceId});1e3===e.code&&(this.versionId=e.data)}catch(e){console.error("getVersionId error: ",e)}},getDynamicTagRuleInfo(e){const{tagId:t,tagKey:a}=e;let i=null;switch(a){case"button_click":i={dialogueNodeId:"",buttonId:"",count:0};break;case"dialog_show":i={showDialogueNodeId:"",showCount:0};break;case"time_hit":i={type:1,time:"",staticTimeVal:"",inferenceTimeVal:"",intervalTimeVal:["08:00:00","09:00:00"],inferRegionStartVal:"",inferRegionEndVal:""};break;default:break}return i},initTagsSuggestions(){const e=["button_click","dialog_show","dmp_crowd","event_hit"];e.forEach((e=>{this.fetchTagSuggestions({tagKey:e})}))},handleAddRule(e){console.debug("addRule: ",e),this.showHitTip=!1,this.ruleJson.rules.length>50&&this.$message({message:"已达最大数量",type:"error"});const t=["button_click","dialog_show","dmp_crowd","event_hit"];t.includes(e.tagKey)&&(this.cache[e.tagKey]||this.fetchTagSuggestions(e));let a="";a=["button_click","dialog_show"].includes(e.tagKey)?">=":"=",this.ruleJson.rules.push({condition:"AND",rules:[{dataSource:e.dataSource,inputType:e.inputType,tagId:e.tagId,tagKey:e.tagKey,tagType:e.tagType,tagName:e.tagName,operator:a,value:"",...this.getDynamicTagRuleInfo(e)}]}),console.debug("handleAddRule cache: ",this.cache)},handleAddChildRule(e,t){if(console.debug("handleAddChildRule: ",e,t),e.rules.length>=50)return void this.$message({type:"error",message:"已达最大数量"});const a=["button_click","dialog_show","dmp_crowd","event_hit"];a.includes(t.tagKey)&&(this.cache[t.tagKey]||this.fetchTagSuggestions(t));let i="";i=["button_click","dialog_show"].includes(t.tagKey)?">=":"=",e.rules.push({dataSource:t.dataSource,inputType:t.inputType,tagId:t.tagId,tagKey:t.tagKey,tagType:t.tagType,tagName:t.tagName,operator:i,value:"",...this.getDynamicTagRuleInfo(t)}),console.debug("handleAddChildRule cache: ",this.cache)},initDynamicData(){this.ruleJson.rules.forEach((e=>{e.rules.forEach(((e,t)=>{switch(e.tagKey){case"button_click":this.getDialogueButtonList(e.dialogueNodeId,e.tagKey);break;default:break}}))}))}},async mounted(){},async created(){await this.getVersionId(),this.initTagsSuggestions(),this.initDynamicData()}},c=s,u=a(1001),d=(0,u.Z)(c,i,n,!1,null,"5656f627",null),p=d.exports},49130:function(e,t,a){a.d(t,{AZ:function(){return p},LS:function(){return s},Me:function(){return r},OY:function(){return c},Xr:function(){return o},ce:function(){return u},hj:function(){return l},jn:function(){return h},lw:function(){return g},o:function(){return n},oY:function(){return d},rT:function(){return m}});var i=a(56414);function n(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/node/start/get",params:e})}function l(e){return(0,i.Z)({method:"post",url:"proactive_admin_api/interactify/node/start/update",data:e})}function o(e){return(0,i.Z)({method:"post",url:"proactive_admin_api/interactify/node/assert/add",data:e})}function r(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/node/assert/get",params:e})}function s(e){return(0,i.Z)({method:"post",url:"proactive_admin_api/interactify/node/assert/update",data:e})}function c(e){return(0,i.Z)({method:"delete",url:"proactive_admin_api/interactify/node/del",params:e})}function u(e){return(0,i.Z)({method:"post",url:"proactive_admin_api/interactify/node/dialog/add",data:e})}function d(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/node/dialog/get",params:e})}function p(e){return(0,i.Z)({method:"post",url:"proactive_admin_api/interactify/node/dialog/update",data:e})}function g(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/node/tree/get",params:e})}function m(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/node/versionId",params:e})}function h(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/node/select",params:e})}},23304:function(e,t,a){a.d(t,{FS:function(){return s},Or:function(){return l},Q4:function(){return r},X_:function(){return c},lo:function(){return n},mr:function(){return o}});var i=a(56414);function n(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/service/list",params:e})}function l(e){return(0,i.Z)({method:"post",url:"proactive_admin_api/interactify/service/add",data:e})}function o(e){return(0,i.Z)({method:"delete",url:"proactive_admin_api/interactify/service/del",params:e})}function r(e){return(0,i.Z)({method:"post",url:"proactive_admin_api/interactify/service/offline",params:e})}function s(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/node/bar/title",params:e})}function c(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/node/reset",params:e})}},66770:function(e,t,a){a.d(t,{G0:function(){return n},Rd:function(){return l},ZE:function(){return o},gL:function(){return r},o$:function(){return s}});var i=a(56414);function n(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/tag/list",params:e})}function l(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/setting/admin/crowd/list",params:e})}function o(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/tag/node",params:e})}function r(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/interactify/tag/button",params:e})}function s(e){return(0,i.Z)({method:"get",url:"proactive_admin_api/scene/event/list",params:e})}}}]);
//# sourceMappingURL=569.da292e92.js.map